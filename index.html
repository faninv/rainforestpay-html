<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script>
    var isProd;

    function sendLogMessage(message) {
      if (window.LogChannel) {
        window.LogChannel.postMessage(message);
      }
    }

    window.addEventListener('load', function() {
      sendLogMessage('from JavaScript: Embeddable Page loaded.');
    });

    function loadPaymentScript() {
      const script = document.createElement('script');
      script.type = 'module';
      script.src = isProd 
        ? 'https://static.rainforestpay.com/payment.js'
        : 'https://static.rainforestpay.com/sandbox.payment.js';

      document.head.appendChild(script);
      sendLogMessage('loadPaymentScript done. script.src ' + script.src);
    }

    function addPaymentElement(sessionKey, payinConfigId) {
      sendLogMessage('initializePaymentForm sessionKey ' + sessionKey);
      sendLogMessage('initializePaymentForm payinConfigId ' + payinConfigId);

      const paymentElement = document.createElement('rainforest-payment');
      paymentElement.id = 'pay-form';
      paymentElement.setAttribute('session-key', sessionKey);
      paymentElement.setAttribute('payin-config-id', payinConfigId);
      paymentElement.setAttribute('allowed-methods', 'CARD');
      paymentElement.setAttribute('style-button-color', '#212121');
      paymentElement.setAttribute('style-button-border-radius', '90rem');
      paymentElement.setAttribute('style-font-family', "'ProximaNova',sans-serif");

      document.body.appendChild(paymentElement);

      sendLogMessage('addPaymentElement done');
    }

    document.addEventListener('DOMContentLoaded', function () {
      sendLogMessage('DOMContentLoaded done');
      const params = new URLSearchParams(window.location.search);
      isProd = params.get('isProd') === 'true';

      loadPaymentScript();
    });

    // window.addEventListener('load', function() {
    //   sendLogMessage('from JavaScript: Embeddable Page loaded.');
    // });

      // function onPaymentApprovedDartCallbackMobile(payin_id) {
      //   if (window.OnPaymentApprovedDartCallbackMobileChannel) {
      //     window.OnPaymentApprovedDartCallbackMobileChannel.postMessage(payin_id);
      //   }
      // }

      // function onPaymentApproved(data) {
      //   var payinId = data.detail[0].data.payin_id;
      //   onPaymentApprovedDartCallbackMobile(payinId);                                              
      // }

      // function onPaymentDeclinedDartCallbackMobile(payin_id) {
      //   if (window.OnPaymentDeclinedDartCallbackMobileChannel) {
      //     window.OnPaymentDeclinedDartCallbackMobileChannel.postMessage(payin_id);
      //   }
      // }

      // function onPaymentDeclined(data) {
      //   var payinId = data.detail[0].data.payin_id;
      //   onPaymentDeclinedDartCallbackMobile(payinId);
      // }

      // function onPaymentErrorDartCallbackMobile(err) {
      //   if (window.OnPaymentErrorDartCallbackMobileChannel) {
      //     window.OnPaymentErrorDartCallbackMobileChannel.postMessage(err);
      //   }
      // }

      // function onPaymentError(err) {
      //   onPaymentErrorDartCallbackMobile(err);
      // }

      // function onNoFormDartCallbackMobile() {
      //   if (window.OnNoFormDartCallbackMobileChannel) {
      //     window.OnNoFormDartCallbackMobileChannel.postMessage();
      //   }
      // }

      // function onNoForm() {
      //   onNoFormDartCallbackMobile();
      // }

      // function addEventListeners() {
      //   var form = document.getElementById('pay-form');
      //   if (!form) {
      //     onNoForm();
      //   }

      //   form.addEventListener('approved', onPaymentApproved);
      //   form.addEventListener('declined', onPaymentDeclined);
      //   form.addEventListener('error', onPaymentError);
      // }

      // function removeEventListeners() {
      //   var form = document.getElementById('pay-form');
      //   if (form) {
      //     form.removeEventListener('approved', onPaymentApproved);
      //     form.removeEventListener('declined', onPaymentDeclined);
      //     form.removeEventListener('error', onPaymentError);
      //   }
      // }

      // window.addEventListener('load', function() {
      //   addEventListeners();
      // });
      // window.addEventListener('beforeunload', removeEventListeners);
  </script>
</head>
<body>
  <p>debug in html</p>
</body>
</html>